---
date: 15.11.2023
tags:
  - theory
  - databases
---
Цель ограничений - обеспечить соответствие данных предметной области.

Уровень, на котором можно наложить ограничения.
- уровень строки
  Проверочное ограничение (check constraint)
  Предикат, который определен от атрибутов таблицы.
- уровень таблицы
  Пример - ограничение уникальности.
  Определяются при помощи триггеров.
- уровень нескольких таблиц
  Пример - ограничение ссылочной целостности. Задается при создании дочерней таблицы или изменении ее структуры.

> [!NOTE] UDP(SP), UDF
> На стороне СУБД могут создаваться UDP(SP) и UDF.
> 
> 	SP - stored procedure
> 	UDF - user defined functions
> 
> Не SQL содержит UDF и SP, а наоборот - UDF могут содержать SQL запрос.

# `NULL` значение
`NULL` - это отдельное значение, можно сказать, отдельный тип. Пустая строка или ноль - не являются `NULL`.

Проверка значение на `NULL` не возвращает `true`.
```sql
select * from ...
where value = NULL
```
Код ничего не вернет.

Для проверки на `NULL` значение используется `is`.
```sql
select * from ...
where value is NULL
```
Код вернет все записи, где `value` - `NULL`.

Поля, которые могут содержать `NULL` нельзя использовать в ключах.

---
$R_{1}=\langle H_{1},S_{1}\rangle$
$R_{2}=\langle H_{2},S_{2}\rangle$
$H_{1}=\langle A_{1},\dots,A_{n},B_{1},\dots,B_{k}\rangle$
$H_{2}=\langle A_{1},\dots,A_{n},C_{1},\dots,C_{m}\rangle$

Соединения таблиц в SQL:
- inner join $R_{1}\Join R_{2}$
- left outer join 
  $R=\langle H,S\rangle$, где $H=\langle A_{1},\dot,A_{n},B_{1},\dots,B_{k},C_{1},\dots,C_{m}\rangle$ и $S=\langle a_{1},\dots,a_{n},b_{1},\dots,b_{k},\text{null},\dots,\text{null}\rangle$, если $S_{2}$ не начинается с $a_1,\dots,a_{n}$.  
> [!example]- Пример
> $R_{1}$
> 
> |1|$\alpha$|
> |---|---|
> |2|$\alpha$|
> |3|$\beta$|
> |2|$\gamma$|
> 
> $R_{2}$
> 
> |$\alpha$|a|
> |---|---|
> |$\alpha$|b|
> |$\gamma$|a|
> 
> $R$
> 
> |1|$\alpha$|a|
> |---|---|---|
> |1|$\alpha$|b|
> |2|$\alpha$|a|
> |2|$\alpha$|b|
> |3|$\beta$|null|
> |2|$\gamma$|a|
- right outer join
  аналогично с left, но null выставляются относительно правого отношения
  $R=\langle H,S\rangle$, где $H=\langle A_{1},\dot,A_{n},B_{1},\dots,B_{k},C_{1},\dots,C_{m}\rangle$ и $S=\langle \text{null},\dots,\text{null},\text{null},\dots,\text{null},c_{1},\dots,c_{m}\rangle$, если $S_{2}$ не начинается с $a_1,\dots,a_{n}$.  
- full outer join
  объединение left и right outer join

# Хранение данных
СУБД хранит данные в страницах по 4 Кб.

LOB (Large OBjects) - большие объекты. Например, мультимедиа файлы, длинные тексты. Для хранения текстов - CLOB(Character LOB) и т.д.

Для некоторых СУБД ограничение по размеру LOB - 2 Гб. Некоторые СУБД в талице хранятся указатели на файлы во внешней (относительно СУБД) ФС.
Поиск по полям типа LOB обычно не осуществляется.
Часто LOB хранятся в виде локаторов (указателей) на область, выделенную внутри СУБД под LOB.

# Индексы
В неотсортированной таблице скорость поиска пропорциональна количеству записей ($K$). В отсортированной - $\log{(K)}$.

Для каждого значения $a_{i}$ поля $A$ создается список(таблица) записей $b_{j}$, содержащих это значение.

Типы индексов:
- B-tree - бинарное дерево
  Есть начальные (initial), промежуточные (intermediate) и листовые (leaf) узлы (nodes).
- Hash
  Для каждого значения поля $a_{i}$ вычисляется $h(a_{i})\mod m$ - номер ячейки от 0 до $m$ и $h(a_{i})div \;m$ - номер записи в ячейке


> [!example] Пример бинароного дерева
> Англоязычный алфавит можно пронумеровать по порядку.
> Initial nodes: F, N, Z.
> В эти узлы входят элементы, меньшие значения узла (A<F, K<N)
> Intermediate nodes: A,B,C,D,...
> Leaf nodes: rid's (row ID).

```sql
CREATE INDEX
medical.e1 on medical.events
(card_id, startdate desc)
```

При создании индекса следует помнить, что:
- Индекс занимает место. Иногда сравнимое с размером таблицы.
- Индекс нужно поддерживать.
- Компиляция запроса происходит дольше, т.к. менеджер запросов просчитывает больше вариантов.

Если один индекс используется сильно чаще других, записи можно перестраивать в соответствии с этим индексом. Такой индекс называется **кластерным**.