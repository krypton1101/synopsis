---
date: 03.11.2023
tags:
  - theory
  - operational_systems
---
# Файл 
С одной стороны, это формально не определяемое понятие.
Сточки зрения смысла файл - множество данных, объединенных некоторой логической связью, т.е. одна и та же совокупность данных может рассматриваться как один или несколько файлов.

Признаки файла
1. файл объединяет множество данных
2. обладает именем
3. с целью долговременного и надежного хранения информации располагается на внешнем устройстве
4. предполагает многократное использования информации с разрывом во времени
5. предполагает совместное использование информации несколькими приложениями или пользователями, одновременно (разделяемый ресурс) или с разрывом во времени

# Файловая система
Файловая система как часть операционной системы это подсистема, включающая:
- наборы структур данных, используемых для управления файлами (каталоги файлов, дескрипторы файлов, таблицы распределения свободного и занятого пространства на диске)
- комплекс системных программных средств, реализующих управление файлами

Общая задача файловой системы состоит в предоставление пользователю логической модели для работы с файлами и отображении этой модели на физическую организацию внешнего устройства.

# Логическая модель
Логическая модель обеспечивает удобный для пользователя интерфейс и скрывает физическую организацию работы с внешними устройствами. Этот интерфейс обеспечивает следующие логические операции и средства:
- именование файлов
- поддержка различных типов файлов
- задание атрибутов файлов,
- организация хранения множества файлов
- поддержка логической организации файлов,
- предоставление программного интерфейса для работы с различными файлами

Отображение логической модели на физическую организацию внешнего устройства, или, что тоже, реализация этой модели на физическом уровне, предполагает следующее:
1. отображение (трансляция) имен файлов в адреса внешней памяти (сектора диска, адреса флэш- накопителя и т.п.)
2. размещение данных на устройстве
3. обеспечение доступа к данным
4. буферизация обмена
5. организаций совместного использования файлов (блокировка, предотвращение гонок и тупиков согласование копий и др.)
6. защита файлов одного пользователя от несанкционированного доступа другого
7. восстановление файлов в случае возникновения ошибок различного рода
8. обеспечение устойчивости файловой системы к сбоям питания и программно-аппаратным ошибкам
9. обеспечение работы с файлами в сети

# Логическая организация файловой системы
## Имена файлов
Правила формирования имен файлов определяются операционной системой и учитываются ограничения на используемые символы, длину и структуру имени.

**Например**, файловые системы ОС Unix различают символы верхнего и нижнего регистров (большие и малые буквы), тогда как для ОС семейства Windows регистр не учитывается.

Современные файловые системы, как правило, поддерживают длинные символьные имена файлов. Например, Windows NT в файловой системе NTFS устанавливает, что имя файла может содержать до 255 символов, не считая завершающего нулевого символа.

В некоторых системах одному и тому же файлу не может быть дано несколько разных имен (например, в ОС семейства Microsoft). В других такое ограничение отсутствует (например, «ОС UNIX). В последнем случае файл не имеет имени как такового. С каждым файлом ФС связывает индексный дескриптор, хранящий метаданные содержащие все характеристики файла. Имя файла является указателем на его метаданные и, как следствие, на одни и те же метаданные может указывать несколько указателей. Действия по заданию альтернативных имен (псевдонимов) осуществляются командами ОС.
## Расширение
Понятие расширения введена в MS DOS, OC UNIX она отсутствует. Тенденция развития ФС такова, что ограничение на структуру имени снимается и в ОС семейства Microsoft в имени файла может присутствовать более одной точки, однако в этих ОС последние символы после точки сохраняют свою роль, так как распознаются приложениями С другой стороны, в ОС UNIX также используются соглашения об именовании файлов, согласно которым тип файла в имени отделяется точкой.

## Типы файлов
Обычные файлы содержат информацию произвольного характера, которую заносит в них пользователь или программа, системная или пользовательская. Содержание такого файла определяется приложением, которое с ним работает. Системное или стандартное приложение создает и распознает файлы своего собственного формата (текстовый редактор Word файлы `.doc`, графическая программа Photoshop - `.psd`, пользовательское приложение интерпретирует содержимое файла в соответствии с задачей и способом ее решения.

## Каталог
**Каталог** - системный файл, содержащий системную информацию о группе файлов, его составляющих. В каталоге содержится список файлов, входящих в него, и устанавливается соответствие между файлами и их характеристиками (атрибутами). Двойственный смысл, вкладываемый в понятие каталог, практически не приводит к недоразумениям, так как в одном случае речь идет о схеме хранения файлов, а в другом о хранении информации, описывающей ту схему.

Каталог Unix - таблица, каждая запись которой соответствует некоторому файлу и содержит имя файла и указатель на дополнительную информацию - метаданные, хранящиеся в индексных дескрипторах.

Каталог MS DOS хранит имена файлов и целый ряд атрибутов - дату и времена создания, последнего доступа и изменения, текущий размер файла, признаки "только для чтения", "архивный файл", "скрытый файл", "системный файл", номер начального кластера файла.

## Специальные файлы
Специальные файлы это файлы, ассоциированные с устройствами ввода-вывода, которые позволяют пользователю выполнять операции ввода-вывода, используя обычные команды записи в файл или чтения из файла. Эти команды обрабатываются вначале программами файловой системы, а затем преобразуются ОС в команды управления соответствующим устройством.

## Символьная связь
Символьная связь (Unix) - особый тип файла, позволяющий косвенно адресовать другой файл.

Символьная связь создается командным путем с целью использования файла некоторого каталога другом каталоге. В итоге с точки зрения пользователя в его каталоге присутствует нужный файл, реально жетам присутствует символьная связь.

## Атрибуты файлов
Атрибут - это информация, описывающая некоторое свойство файла, или некоторая характеристика файла. В разных файловых системах могут использоваться разные атрибуты и их наборы, хотя реально для современных файловых систем как смысл атрибутов, так и их совокупности имеют тенденцию к сближению.

### Примеры атрибутов
- тип файла
- владелец файла (NTFS, Unix)
- создатель файла
- пароль для доступа к файлу (NTFS, Unix)
- информация о возможности доступа (права доступа) (NTFS, Unix)
- времена создания, последнего доступа и последнего изменения (везде)
- текущий размер файла (везде)
- максимальный размер файла
- признак "только для чтения"
- признак "скрытый файл" (FAT, NTFS)
- признак "системный файл", носят информативно-рекомендательный характер
- признак "архивный файл"
- признак "двоичный/символьный" (Unix)
- признак "временный" (удалить после завершения процесса) (Unix)
- признак блокировки (NTFS, Unix)
- длина записи
- указатель на ключевое поле в записи
- длина ключа

# Действия при обращении из программы к данным на диске FAT
Последовательное обращение (например чтение) Физический номер первого кластера определяется по записи о файле в каталоге Первым читается этот кластер. В ячейке FAT, соответствующей этому кластеру, записан номер следующего кластера файла и т.д.

При чтении из текущего кластера позиция указателя файла смещается на число считанных байтов. Когда данные кластера исчерпаны, по содержимому соответствующей ячейки FAT определяется, какой кластер читать далее. Этот кластер становится текущим и т.д.
![[IMG20231124102602~2.jpg|400]]

# Действия при обращении из программы к данным на диске UFS
- **Последовательное обращение.** Первым читается кластер, физический номер которого записан в нулевом (первом по счету) поле адреса. Номер следующего кластера файла записан в первом поле адреса и т.д.
  При чтении из текущего кластера позиция указателя файла смещается на число считанных байтов. По исчерпании данных текущего кластера считыванию подлежит кластер, номер которого указан в следующем поле адреса. Этот кластер становится текущим и т.д.
  
- **Прямой доступ.** Непосредственно в операции чтения указывается позиция первого считываемого байта файла. По номеру этого байта определяется порядковый номер кластера в файле. Пусть этот номер - $n$. При $n\leq12$ физический номер кластера расположен в $n$-м поле адреса; при $n>12$ для определения этого номера используется косвенная адресация.

# Файловые системы ОС семейства Microsoft
## FAT
Общая организация файлов связанный список индексов.

Цифры в названиях конкретных версий FAT означают разрядность индексных указателей (элементов таблицы FАТ).

Размер кластеров выбирается из диапазона от 512 байтов до 64 кб.

- FAT12 используется для форматирования небольших дисков (до 16 мб), практически - дискет. Поддерживает только короткие имена файлов по схеме «8.3». Эта ФС соответствует первым версиям ОС MS DOS.

- FAT16 используется для дисков до 2 гб (небольших винчестеров). Максимальный размер раздела под FAT16 ограничен 4 гб (65 536 кластеров по 64 кб). Соответствует ОС MS DOS и Windows.

- FAT32 - файловая система, адекватная современным дисковым накопителям. Использует кластеры разного объема: 4 кб для дисков до 8 гб; 8, 16, 32 КБ для дисков большего объема. Максимальный размер раздела практически не ограничен - $2^{32}$ кластеров по 32 кб. Поддерживает короткие и длинные имена файлов. Соответствует всем ОС Windows.

- exFAT (иногда называется FAT64)
  Размер кластера по умолчанию для файловой системы exFAT составляет от 4 КБ до 128 КБ в зависимости от размера тома, максимальный допустимый по спецификации 32 МБ.
	
	Преимущества.
	
	1. Уменьшение количества перезаписей одного и того же сектора, что важно для флеш-накопителей, у которых ячейки памяти необратимо изнашиваются после определенного количества операций записи
	2. Теоретический лимит на размер файла $2^{64}$ байт (16 эксабайт).
	3. Максимальный размер кластера увеличен до $2^{25}$ байт (32 мегабайта).
	4. Улучшение распределения свободного места за счет введения бит-карты свободного места, что может уменьшать фрагментацию диска.
	5. Введена поддержка списка прав доступа.
	
	Недостаток:
	1. Количество файлов в подкаталогах ограничено числом 2'796'202 ($\frac{2^{23}}{3}$)
	
## NTFS
Общая организация файлов основана на методе перечисления номеров кластеров файла. Для сокращения адресной информации адресуются не отдельные кластеры, а непрерывные области смежных кластеров диска отрезки (run), или экстенты (extent). Экстент описывается парой чисел «начальный номер кластера - количество кластеров в экстенте». ФС NTFS используется в ОС Windows NT/2000/XP.

# Файловые системы UNIX
- UFS
  Общая организация файлов основана на методе перечисления номеров кластеров файла, сочетаемом с косвенной адресацией кластеров.
- FFS
  Внесены существенные улучшения в архитектуру предшествующих ФС, повышающие производительность и надежность системы. FFS обладает полной функциональностью s5 и ufs, но оптимизированы расположение ФС на диске, дисковые структуры данных и алгоритмы размещения свободных блоков. Это базовая ФС BSD Unix.
- ext4
  Журналируемая файловая система, используемая преимущественно в операционных системах с ядром Linux, созданная на базе ext3 в 2006 году.
  - максимальный объём одного раздела диска до 1 эксобайта ($2^{60}$ байт) при размере блока 4 килобайта;
  - размер одного файла до 16 терабайт ($2^{44}$ байт);
  - механизм **протяжённой** (extent) записи файлов, уменьшающий фрагментацию и повышающий производительность (новая информация добавляется в конец области диска, выделенной заранее по соседству с областью, занятой файлом);
  - ограничение на число вложенных каталогов до 65 535.