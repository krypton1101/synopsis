---
date: 2023-11-24
tags:
  - theory
  - operational_systems
---
# Основные задачи управления вводом-выводом
Управление всеми устройствами ввода-вывода компьютера является одной из главных функций ОС. ОС должна:
- передавать устройствам команды
- перехватывать прерывания и обрабатывать ошибки
- обеспечивать интерфейс между устройствами и остальной частью системы

Для обеспечения модифицируемости и расширяемости системы интерфейс должен быть одинаковым для всех типов устройств (независимость от устройств).

# Физическая организация устройств ввода-вывода
Устройства ввода-вывода делятся на два типа: блок-ориентированные устройства и байт-ориентированные устройства.

Блок-ориентированные устройства хранят информацию в блоках фиксированного размера, каждый из которых имеет свой собственный адрес. Самое распространенное блок-ориентированное устройство - диск.

Байт-ориентированные устройства не адресуемы и не позволяют производить операцию поиска, они генерируют или потребляют последовательность байтов. Примерами являются терминалы, строчные принтеры, сетевые адаптеры.

# Взаимодействие ОС с внешними устройствами
Операционная система обычно имеет дело не с устройством, а с контроллером. Контроллер как правило выполняет простые функции, например, преобразует поток битов в блоки, состоящие из байтов, и осуществляют контроль и исправление ошибок. Каждый контроллер имеет несколько регистров, которые используются для взаимодействия с центральным процессором.

ОС выполняет ввод-вывод, записывая команды регистры контроллера. Когда команда принята, процессор оставляет контроллер и занимается другой работой. При завершении команды контроллер организует прерывание для того, чтобы передать управление операционной системе, которая должна проверить результаты операции. Процессор получает результаты и статус устройства, читая информацию из регистров контроллера.

# Основные проблемы организации ПО ввода-вывода
Основная идея организации программного обеспечения ввода-вывода состоит в разбиении его на несколько уровней, причем нижние уровни обеспечивают экранирование особенностей аппаратуры от верхних, а те, в свою очередь, обеспечивают удобный интерфейс для пользователей.

**Независимость от устройств.** Вид программы не должен зависеть от того, читает ли она данные с гибкого диска или с жесткого диска.

**Использование блокирующих (синхронных) и неблокирующих (асинхронных) передач.** ОС выполняет операции ввода-вывода асинхронно, но представляет их для пользовательских программ в синхронной форме.

**Разделимость устройств.** Пример: Принтеры это выделенные (неразделяемые) устройства, потому что нельзя смешивать строчки, печатаемые различными пользователями.

# Структура ввода-вывода
Программное обеспечение ввода-вывода разделяется не четыре слоя:
1. обработка прерываний
2. драйверы устройств
3. независимый or устройств стой операционной системы
4. пользовательский слой программного обеспечения

![[IMG20231201103314.jpg]]

## Обработка прерываний
Прерывания должны быть скрыты как можно глубже в недрах операционной системы, чтобы как можно меньшая часть ОС имела с ними дело.

Наилучший способ состоит в разрешении процессу, инициировавшему операцию ввода-вывода, блокировать себя до завершения операции и наступления прерывания, свидетельствующего о завершении этой операции.

При наступлении прерывания процедура обработки прерывания выполняет разблокирование процесса, инициировавшего операцию ввода-вывода Эффект от прерывания будет состоять в том, что ранее заблокированный процесс теперь продолжит свое выполнение.

## Драйверы устройств
Весь зависимый от устройства код помещается в драйвер устройства. Каждый драйвер управляет устройствами одного типа. Только драйвер устройства знает о конкретных особенностях какого-либо устройства.

Драйвер устройства принимает запрос от устройств программного слоя и решает, как его выполнить. Типичный запросом является чтение $n$ блоков данных. Если драйвер был свободен во время поступления запроса, то запрос начинает выполняться немедленно, иначе он ставится в очередь запросов к драйверу.

### Реализация запроса ввода-вывода
Первый шаг в реализации запроса ввода-вывода состоит в преобразовании его из абстрактной формы в конкретную, те в последовательность операций контроллера.

После передачи команды контроллеру драйвер должен решить, блокировать ли себя до окончания заданной операция или нет.

Если операция занимает значительное время, то драйвер блокируется до завершения операции и обработчик прерывания не разблокирует его.

Если команда ввода-вывода выполняется быстро (например, прокрутка экрана), то драйвер ожидает ее завершения без блокирования.

## Независимый от устройств слой ОС
Большая часть программного обеспечения ввода-вывода является независимой от устройств.

Типичными функциями для независимого от устройств слоя являются:
1. обеспечение общего интерфейса к драйверам устройств,
2. именование устройств,
3. защита устройств,
4. обеспечение независимого размера блока,
5. буферизация,
6. распределение памяти на блок-ориентированных устройствах,
7. распределение и освобождение выделенных устройств,
8. уведомление об ошибках

## Пользовательский слой ПО
**Системные процедуры.** В общем случае часть программного обеспечения ввода-вывода входит в состав ОС, часть содержится в стандартных библиотеках, связываемых с пользовательскими программами.

**Подсистема спулинга (spooling).** Спулинг - это способ работы с выделенными (не разделяемыми между процессами) устройствами в мультипрограммной системе.

Если просто позволить каждому пользовательскому процессу открыть специальный файл, связанный с принтером, то принтер может быть монополизирован процессом на произвольное время, что недопустимо. Поэтому создается специальный процесс - монитор, получающий исключительные права на использование устройства, и специальный каталог - каталог спулинга.

