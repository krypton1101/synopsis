---
date: 2023-10-27
tags:
  - theory
  - operational_systems
---
# Запоминающие устройства
Память вычислительной машины, представленная совокупностью запоминающих устройств (ЗУ) различных видов, может быть иерархизирована по следующим основным признакам:
- время доступа к данным
- объем
- стоимость хранения данных в расчете на один бит

## Иерархия запоминающих устройств
Чем больше быстродействие, тем больше стоимость хранения данных в расчете на один бит и меньше объем устройства. Кэш-память представляет некоторое компромиссное решение этой проблемы.

![[IMG20231027103858.jpg]]

### Кэш-память
**Кэш-память** (cache) - это способ организации совместного функционирования двух типов запоминающих устройств, отличающихся временем доступа и стоимостью хранения данных, который позволяет уменьшить среднее время доступа к данным за счет динамического копирования в "быстрое" ЗУ наиболее часто используемой информации из "медленного" ЗУ.

Кэш-памятью часто называют не только способ организации работы двух типов запоминающих устройств, но и одно из устройств "быстрое" ЗУ.

#### Функционирование кэш-памяти
Содержимое кэш-памяти представляет собой совокупность записей обо всех загруженных в нее элементах данных из основной памяти. Каждая запись об элементе данных включает в себя
- **значение элемента данных**
- **адрес**, который этот элемент данных имеет в основной памяти
- **управляющую информацию** для реализации алгоритма замещения, обычно признак модификации и признак обращения к данным за некоторый последний период времени

##### Схема функционирования кэш-памяти
При каждом обращении к основной памяти по физическому адресу просматривается, содержимое кэш-памяти с целью определения, не находятся ли там нужные данные. Поиск нужных данных осуществляется по содержимому - взятому из запроса значению поля адреса в оперативной памяти. Далее возможно одно из двух:
- **произошло каш-попадание** - данные обнаружены в кэш-памяти, они считываются из кэш-памяти и результат передается источнику запроса
- **произошел кэш-промах** (cache-miss) - нужных данных нет, они считываются из основной памяти, передаются источнику запроса и одновременно копируются в кэш-память

![[IMG20231027110105.jpg]]

#### Среднее время доступа к данным
Пусть имеется основное запоминающие устройство со средним временем доступа к данным $t_1$ и кэш-память, имеющая время доступа $t_2$ ($t_2<t_1$). Обозначим через $t$ среднее время доступа к данным в системе с кэш-памятью, через $р$ - вероятность попадания в кэш. По формуле полной вероятности имеем:
$$t=t_{1}(1-p)+t_{2}p$$
Видно, что среднее время доступа изменяется от среднего времени доступа в основное ЗУ (при $p=0$) до среднего времени доступа непосредственно в кэш-память (при $p=1$).

В реальных системах вероятность попадания в кэш очень высока и составляет более $0.9$, потому что данные имеют свойства: **пространственной** и **временной локальности**.

##### Свойства данных
**Пространственная локальность**. Если произошло обращение по некоторому адресу, то с высокой степенью вероятности в ближайшее время произойдет обращение к соседним адресам.

**Временная локальность**. Если произошло обращение по некоторому адресу, то следующее обращение по этому же адресу с большой вероятностью произойдет в ближайшее время.

#### Проблемы кэширования
- **Вытеснение данных из каша в основную память**
	В процессе работы содержимое кэш-памяти постоянно обновляется, а значит, периодически данные должны из нее вытесняться. Вытеснение предполагает объявление соответствующей области кэша свободной (сброс бита действительности) и, если вытесняемые данные за время нахождения в кэше были изменены, копирование данных в основную память
- **Согласование данных кэша и основной памяти при записи в последнюю**
	Проблема заключается в том, что при записи данных в основную память их копия в кэше (если она там есть) становится недостоверной. Для решения этой проблемы типичны два подхода:
	- **Сквозная запись (write through).**
		Если данные по запрашиваемому адресу отсутствуют в кэше, то запись выполняется только в основную память, в противном случае одновременно в кэш и основную память.
	- **Обратная запись (write back).**
		Если данные по запрашиваемому адресу отсутствуют в кэше, то запись выполняется только в основную память, в противном случае только в кэш-память. Во втором случае устанавливается признак модификации, указывающий на необходимость записи данных в основную память при вытеснении их из кэша.

#### Способы отображения основной памяти на кэш
##### Случайное отображение
Элемент основной памяти вместе с его адресом размещается в любом месте кэш-памяти. Адрес выступает в качестве признака, по которому производится поиск, или тега (tag). Схема поиска представляет собой ассоциативный поиск, при котором сравнение значения тега выполняется параллельно со всеми записями кэша.

##### Детерминированное отображение
Любой элемент основной памяти всегда отображается в одно и то же место кэш-памяти. Кэш-память разделяется на нумерованные строки. Между номерами этих строк и адресами основной памяти устанавливается соответствие "один ко многим": одному номеру строки соответствует множество адресов основной памяти.

##### Смешанная стратегия
Сочетает описанные подходы и используется во многих современных процессорах. Произвольный адрес основной памяти отображается на некоторую группу адресов КЭШа. Группы пронумерованы. Отображение на группу прямое. Внутри группы отображение случайное.

Поиск в каше осуществляется сначала по номеру группы, полученному из адреса в запросе, а затем - ассоциативно - внутри группы.

Алгоритм замещения может учитывать интенсивность обращения к данным в кэше и тем самым повысить вероятность попадания в будущем.

##### Двухуровневое кэширование
Такая схема используется во многих вычислительных системах.

При выполнении запроса сначала осуществляется поиск уровня. Если произошел промах, то поиск продолжается в каше 2-го уровня, при промах и здесь основной памяти.

При работе такой иерархически организованной памяти необходимо обеспечить многоуровневое копирование и непротиворечивость данных на всех уровнях.
![[IMG20231103102407.jpg|400]]

