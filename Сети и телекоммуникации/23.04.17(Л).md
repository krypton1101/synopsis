# Методы квитирования
**Запрос повторной передачи (Automatic Repeat reQuest, ARQ)**
Отправитель отсылает данные, а получатель подтверждает их получение **квитанциями.** Если отправитель вовремя не получает квитанции на переданные данные, то он передает их повторно.

В связи с неоднозначностью формулировки, появилось множество протоколов передачи данных с квитированием. Их можно разбить классы:
- методы простоя источника (Stop-and-Wait)
- методы скользящего окна
  - передача с возвращением на N пакетов
  - передача с выборочным повторением

Общие черты, присущие всем этим методам:
- Отправитель и получатель, в общем случае работающие асинхронно, осуществляют передачу пакетов по ненадежной линии связи, и которой возможны искажения, большие задержки и потери пакетов
- Отправитель принимает данные от протокола верхнего уровня, получатель передает полученные данные на верхний уровень
- Получатель располагает механизмом определения искаженных пакетов, например по контрольной сумме
- После успешного получения пакета получатель посылает отправителю квитанции
- Для отслеживания задержек пакетов используется таймер, тайм-аут которого устанавливается равным предельному времени ожидания квитанции

## Метод простоя источника
Отправитель передает последовательность ненумерованных пакетов. Метод требует, чтобы отправитель дожидался от получателя квитанции, и только после этого посылал следующий пакет.
![[IMG20230417122753.jpg]]

## Метод скользящего окна (Sliding window)
Для повышения скорости передачи данных отправителю разрешается передать некоторое количество пакетов, не дожидаясь прихода на эти пакеты квитанции.

Окно всегда имеет нижнюю границу - **базу окна** и верхнюю границу.
Количество номеров, попадающих в пределы окна, называют **размером окна.**
![[IMG20230417124556.jpg]]

![[IMG20230417125057.jpg]]

### Передача с возвращением на N пакетов
При получении пакета получатель всегда выполняет одни и те же действия, проверяя:
- является ли пакет искаженным
- является ли он следующим по порядку в последовательности уже полученных пакетов

![[IMG20230417131032.jpg]]
Если хоть одно условие не выполняется, пакет отбрасывается, а отправителю посылается квитанция, в которой указывается номер последнего по времени успешно принятого пакета.

Квитанции имеют кумулятивный характер, т.е. квитанция указывает количество успешно принятых пакетов.

На процесс передачи пакетов влияют следующие события:
- *Исчерпание окна* - ситуация, когда все пакеты из окна отправлены, но не подтверждены. В этом случае передача останавливается.
- *Истечение тайм-аута* - это событие интерпретируется отправителем как потеря пакета или квитанции, а значит, выполняется повторная передача базового пакета и для него заново устанавливается таймер. При этом повторяется передача всех переданных, но не подтвержденных пакетов.
- *Поступление квитанции*. Соответствующий пакет и все пакеты в пределах окна с меньшими номерами считаются успешно принятыми. Окно сдвигается, фиксируется новый базовый пакет, переустанавливается таймер. Если до этого передача была приостановлена из-за исчерпания окна, то передача возобновляется.